/* * Copyright (c) 2020 Ruslan Potekhin */package com.feedapp.app.viewModelsimport androidx.lifecycle.LiveDataimport androidx.lifecycle.ViewModelimport androidx.lifecycle.viewModelScopeimport com.feedapp.app.data.api.models.usdafooddetailed.USDAFoodModelimport com.feedapp.app.data.models.ConverterToProductimport com.feedapp.app.data.models.FoodProductimport com.feedapp.app.data.models.RecentProductimport com.feedapp.app.data.models.day.DayDateimport com.feedapp.app.data.repositories.DayRepositoryimport com.feedapp.app.data.repositories.SearchFoodRepositoryimport com.feedapp.app.data.repositories.UserRepositoryimport kotlinx.coroutines.Dispatchersimport kotlinx.coroutines.launchimport javax.inject.Injectclass DetailedViewModel @Inject constructor(    private val searchRepository: SearchFoodRepository,    private val dayRepository: DayRepository,    private val userRepository: UserRepository) : ViewModel() {    val multiplier = searchRepository.multiplier    val isConnected = searchRepository.isConnected    // 0 - grams' position in array of list by default    val multiplierPosition = searchRepository.multiplierPosition    val isSearching: LiveData<Boolean> = searchRepository.isSearching    val foodInfoOnline: LiveData<USDAFoodModel> = searchRepository.foodInfoOnline    val foodInfoOffline: LiveData<FoodProduct> = searchRepository.foodInfoOffline    /**     * load Detailed information about product from API     */    fun getInfoAboutProduct(id: Int) = searchRepository.getInfoAboutProduct(id)    /**     * search product in offline DB     */    fun searchFoodProduct(id: Int) = searchRepository.searchFoodProduct(id)    fun isMultiplierValueValid(text: String): Boolean {        return !(text.toDouble() > 100 && (multiplierPosition.value != 0))    }    fun canSave(): Boolean {        return isSearching.value == false    }    fun saveConsumedFoodToDB(        dateString: DayDate?,        mealType: Int?,        grams: Float    ) =        viewModelScope.launch(Dispatchers.IO) {            if (dateString == null || mealType == null) return@launch            // save to consumed Products to the specific date            dayRepository.saveSearchProductToDay(                dateString,                mealType,                foodInfoOnline.value,                foodInfoOffline.value,                grams            )            // save to recent products            foodInfoOnline.value?.let {                val recentProduct = RecentProduct(                    product = ConverterToProduct().convertUSDAModel(it, 0f),                    recentFdcId = it.fdcId ?: 0                )                userRepository.saveToRecent(recentProduct)            }        }    fun observeFoodInfo(): LiveData<USDAFoodModel> {        return searchRepository.foodMediator    }    fun setFoodOnline(it: USDAFoodModel?) {        searchRepository.foodInfoOnline.postValue(it)    }    fun changeMultiplierValue(d: Double) {        searchRepository.changeMultiplierValue(d)    }}